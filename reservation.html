<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>예약하기 - 케이크 무인 픽업대 앱</title>
        <script
            type="text/javascript"
            src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=x9fpw4u3bn"
        ></script>
        <link rel="stylesheet" href="producer_styles.css" />
    </head>
    <body style="padding: 0">
        <header>
            <h1>케이크 무인 픽업대 앱</h1>
        </header>
        <main style="padding: 0; margin: 0">
            <div id="reservation-container" class="column">
                    <!-- <h2>실시간 지도</h2> -->
                    <div id="mapContainer">
                        <div id="map" style="width: 100%; height: 500px"></div>

                        <script>
                            var mapOptions = {
                                center: new naver.maps.LatLng(37.3595704, 127.105399),
                                zoom: 10,
                            };

                            var map = new naver.maps.Map('map', mapOptions);
                             naver.maps.Event.once(map, 'init_stylemap', function() {
                                window.setTimeout(function() {
                                    naver.maps.Event.trigger(map, 'resize');
                                }, 500); // Adjust timing as needed
                            });
                        </script>
                        <script type="text/javascript">
                            // 현재 위치를 얻는 함수
                            var curBtn = "<img src='/common/img/curt-locat-icon.png' alt='현재위치로 이동'>";
                            var curLoca = "";
                        
                            // 서울 시청의 위치 정보 객체 생성
                            var sCityHallLoca = new naver.maps.LatLng(37.5666805, 126.9784147);
                        
                            // 맵 객체 생성
                            var map = new naver.maps.Map('map', {
                                center: sCityHallLoca, // 지도의 중심 좌표
                                scaleControl: false, // 축척 컨트롤 표시 여부
                                mapDataControl: false, // 맵 데이터 컨트롤 표시 여부
                                zoom: 17 // 지도의 초기 확대 레벨
                            });
                        
                            // 마커 설정 및 마커 생성
                            var marker = new naver.maps.Marker({
                                position: sCityHallLoca,
                                map: map,
                                icon: { url: "/common/img/marker-target.png" }
                            });
                        
                            // 마커 클릭 이벤트 핸들러 함수
                            var markerClickHandler = function() {
                                return function() { alert("Marker Seoul City Hall"); }
                            }
                        
                            naver.maps.Event.addListener(marker, 'click', markerClickHandler());
                        
                            // 맵 시청정 중앙 위치로 이동 처리 함수 (최초마커로 이동 버튼을 추가)
                            naver.maps.Event.once(map, 'init_stylemap', function() {
                                // 최초 마커로 이동 버튼을 CustomControl에 설정
                                // 컨트롤 위치는 맵 오른쪽 상단
                                var csControl = new naver.maps.CustomControl(curBtn, {
                                    position: naver.maps.Position.RIGHT_TOP
                                });
                        
                                csControl.setMap(map);
                            });
                        
                            // 커스텀 컨트롤 클릭시 이벤트
                            naver.maps.Event.addDOMListener(csControl.getElement(), 'click', function() {
                                if (curLoca) {
                                    // 현재 위치로 지도 중앙을 이동 처리
                                    map.setCenter(curLoca);
                        
                                    // 지도의 확대 레벨을 변경
                                    map.setZoom(17);
                                } else {
                                    alert("현재 위치가 설정되어있지 않습니다. 위치정보에 대한 권한이 필요합니다.");
                                }
                            });
                        
                            // onCurrentPosition 함수를 정의 - 성공 시 처리
                            var onSuccessGeolocation = function(position) {
                                // 위치추적
                                curLoca = new naver.maps.LatLng(position.coords.latitude, position.coords.longitude);
                        
                                // 현재 위치로 지도 중앙을 이동 처리
                                map.setCenter(curLoca);
                        
                                // 지도의 확대 레벨을 변경
                                map.setZoom(17);
                        
                                // 현재 위치에 마커 추가
                                new naver.maps.Marker({
                                    position: curLoca,
                                    map: map,
                                    icon: { url: "/common/img/marker-current.png" }
                                });
                            }
                        
                            // onCurrentPosition 에러 처리 함수
                            var onErrorGeolocation = function() {
                                if (navigator.userAgent.toLowerCase().indexOf('trident') > -1 || agent.indexOf('edge/') > -1) {
                                    alert("지원되지 않는 브라우저입니다.");
                                } else {
                                    console.log("현재 위치를 가져오는데 실패하였습니다.");
                                }
                            }
                        
                            // Geolocation HTML5 API를 통해 현재 위치와 관련된 처리를 이어받는다.
                            if (navigator.geolocation) {
                                /*
                                 * navigator.geolocation은 Chrome 50 버전 이후로는 HTTP 환경에서 사용할 경우 위치정보를 얻어
                                 * HTTPS 환경에서만 사용 가능합니다.
                                 * 따라서 'http://localhost' 대신 'https://localhost', 또는 브라우저의, Chrome 등에서 HTTPS 연결을 요청하는 방법을 사용합니다.
                                 */
                                navigator.geolocation.getCurrentPosition(onSuccessGeolocation, onErrorGeolocation);
                            } else {
                                console.log("Geolocation Not Supported Required");
                            }
                        </script>
                        
                    </div>
                </section>
                <section id="reservation" style="margin: 0; border-radius: 20px">
                    <h2>예약하기</h2>
                    <form id="reservationForm">
                        <label for="location">위치</label>
                        <select id="location" name="location">
                            <option value="seongsu">성수역</option>
                            <option value="tukseom">뚝섬역</option>
                            <option value="seoulforest">서울숲역</option>
                        </select>

                        <label for="time">픽업 시간</label>
                        <input type="datetime-local" id="time" name="time" min="09:00" max="18:00" />

                        <label for="locker">사물함 번호</label>
                        <select id="locker" name="locker">
                            <option value="18">18</option>
                            <option value="21">21</option>
                            <option value="29">29</option>
                        </select>

                        <label for="customerName">고객 성함</label>
                        <input type="text" id="customerName" name="customerName" />

                        <label for="customerPhone">고객 전화번호</label>
                        <input type="tel" id="customerPhone" name="customerPhone" />

                        <label for="customerPassword">설정 비밀번호</label>
                        <input type="password" id="customerPassword" name="customerPassword" />
                        <button type="submit" class="custom-btn btn-16">예약하기</button>
                    </form>
                    <p>(영업 시간은 오전 9시~오후 6시이며, 정해진 시간 외에는 예약할 수 없습니다.)</p>
                </section>
            </div>
        </main>
        <script src="app.js"></script>
    </body>
</html>
